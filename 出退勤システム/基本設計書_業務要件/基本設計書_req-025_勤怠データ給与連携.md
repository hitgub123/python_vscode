
# 基本設計書

## ドキュメント概要

本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本 IT 業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要

本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、勤怠データを給与システムへ連携する機能について定義する。

## 要件定義

### 要件一覧

| ID      | 分類                 | 要件名             | 概要                                                                                                                                                         | 利用者             |
| ------- | -------------------- | ------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------ |
| req-025 | 給与システムとの連携 | 勤怠データ給与連携 | 毎月の締め日において、勤怠システムで集計された総労働時間、残業時間、深夜労働時間、休日出勤時間などのデータが、自動的かつ正確に給与計算システムへ連携される。 | 経理部門, 人事部門 |

## 機能設計

### 勤怠データ給与連携機能 (req-025)

#### 機能概要

毎月締め日に、出退勤システムに記録された従業員の勤怠データを集計し、給与システムへ連携する機能を提供する。連携データには、総労働時間、残業時間、深夜労働時間、休日出勤時間などを含む。

#### 入力仕様

- **締め日**: システム設定で定義された締め日。
- **勤怠データ**: 出退勤システムに記録された各従業員の出退勤記録。
  - 従業員 ID
  - 出勤日
  - 出勤時刻
  - 退勤時刻
  - 休憩時間
  - 休暇情報

#### 出力仕様

- **連携データ**:
  - 従業員 ID
  - 総労働時間（時間）
  - 残業時間（時間）
  - 深夜労働時間（時間）
  - 休日出勤時間（時間）
  - その他（必要に応じて、遅刻回数、早退回数など）
- **連携ファイル形式**: CSV 形式、または給与システムが指定する形式。
- **連携方法**: FTP、API 連携、または給与システムが指定する方法。
- **ログ**: 連携処理の実行結果ログ（成功/失敗、連携件数、エラー内容など）

#### 処理フロー

1. システムは、設定された締め日に、勤怠データ給与連携処理を自動的に実行する。
2. 出退勤システムから、対象期間（締め日から締め日までの期間）の従業員の勤怠データを抽出する。
3. 抽出された勤怠データに基づいて、総労働時間、残業時間、深夜労働時間、休日出勤時間などを集計する。
4. 集計されたデータを、給与システムが指定する形式の連携ファイルに変換する。
5. 連携ファイルを、給与システムへ連携する（FTP、API 連携など）。
6. 連携処理の実行結果をログに出力する。

#### エラー処理

- **データ抽出エラー**: 勤怠データの抽出に失敗した場合、<span style="color:red;">「勤怠データの抽出に失敗しました。詳細ログを確認してください。」</span>というエラーメッセージをログに出力し、処理を中断する。
- **データ集計エラー**: 勤怠データの集計中にエラーが発生した場合、<span style="color:red;">「勤怠データの集計中にエラーが発生しました。従業員 ID: [従業員 ID]、詳細ログを確認してください。」</span>というエラーメッセージをログに出力し、処理を中断する。
- **連携ファイル生成エラー**: 連携ファイルの生成に失敗した場合、<span style="color:red;">「連携ファイルの生成に失敗しました。詳細ログを確認してください。」</span>というエラーメッセージをログに出力し、処理を中断する。
- **連携エラー**: 給与システムへの連携に失敗した場合、<span style="color:red;">「給与システムへの連携に失敗しました。詳細ログを確認してください。」</span>というエラーメッセージをログに出力し、処理を中断する。

## データ設計

### データ連携項目

| 項目名             | データ型     | 説明                 |
| ------------------ | ------------ | -------------------- |
| employee_id        | VARCHAR(10)  | 従業員 ID            |
| total_work_hours   | DECIMAL(5,2) | 総労働時間（時間）   |
| overtime_hours     | DECIMAL(5,2) | 残業時間（時間）     |
| late_night_hours   | DECIMAL(5,2) | 深夜労働時間（時間） |
| holiday_work_hours | DECIMAL(5,2) | 休日出勤時間（時間） |

## インターフェース設計

### 外部インターフェース

- **給与システム連携**
  - プロトコル: FTP, API (給与システム依存)
  - データ形式: CSV, JSON, XML (給与システム依存)
  - ファイル名/エンドポイント: 給与システムとの協議により決定

## 非機能要件

### 性能

- 勤怠データ給与連携処理: 対象従業員数 1000 名の場合、30 分以内に完了すること。

### セキュリティ

- 連携ファイルは暗号化して転送すること（FTP over SSL/TLS, HTTPS など）。
- 給与システムへの API 連携の場合、認証認可機能を実装すること。

## テスト計画

### 単体テスト

- 各種勤怠データ（通常勤務、残業、深夜労働、休日出勤）が正しく集計されることを確認する。
- 連携ファイルが指定された形式で生成されることを確認する。
- 異常データ（不正な時刻、休憩時間のエラーなど）に対するエラー処理が正しく動作することを確認する。

### 結合テスト

- 出退勤システムと給与システム間で、勤怠データが正しく連携されることを確認する。
- 給与システムで、連携された勤怠データに基づいて給与計算が正しく行われることを確認する。

## 付録

### 用語集

- **締め日**: 勤怠データを集計し、給与計算の基礎となるデータを確定する日。
- **給与システム**: 従業員の給与計算を行うシステム。

### 参考資料

- 日本 IT 業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025 年 6 月版）
- 給与システム連携仕様書（給与システムベンダー提供）

