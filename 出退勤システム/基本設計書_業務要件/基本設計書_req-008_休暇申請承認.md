# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要
本システムは、従業員の出退勤時刻の記録や各種申請を管理するシステムである。本設計書では、管理職による休暇申請の承認機能について定義する。

## 要件定義
### 要件一覧
| ID | 分類 | 要件名 | 概要 | 利用者 |
|---|---|---|---|---|
| req-008 | 休暇管理 | 休暇申請承認 | 管理職は、配下の従業員から提出された休暇申請を確認し、承認または却下することができる。 | 管理職 |

## 機能設計
### 休暇申請承認機能 (req-008)
#### 機能概要
管理職が、配下の従業員から申請された休暇内容をWeb管理画面で確認し、承認または却下処理を行う機能を提供する。処理結果は即座に申請者本人へ通知される。

#### 入力仕様
- **承認・却下操作**
  - 承認待ちの休暇申請一覧から、対象の申請を選択する。
  - 「承認」または「却下」ボタンを押下する。
- **コメント入力**
  - 却下時には、理由をコメントとして入力することを必須とする。
  - 承認時にも、任意でコメントを入力できる。

#### 出力仕様
- **画面表示**
  - 処理完了後、「承認しました」「却下しました」等の完了メッセージを表示する。
  - 処理済みの申請は、承認待ち一覧から消える。
- **通知**
  - 承認または却下処理が完了した際、申請者本人に結果（承認/却下、およびコメント）をメール等で通知する。

#### 処理フロー
1. 管理職がWeb管理画面にログインし、「承認ワークフロー」等のメニューを選択する。
2. システムが、管理職の配下にある従業員から提出され、かつ「申請中」ステータスの休暇申請を一覧表示する。
3. 管理職が一覧から特定の申請を選択し、詳細（期間、理由など）を確認する。
4. 管理職が「承認」または「却下」ボタンを押下する。（却下の場合はコメントを入力）
5. システムが、休暇申請テーブルのステータスを「承認」または「却下」に更新し、処理者IDと処理日時、コメントを記録する。
6. 【有給休暇承認時】システムが、従業員マスタの有給残日数から取得日数を減算する。
7. システムが、申請者本人へ処理結果を通知する。
8. 画面に処理完了メッセージを表示し、承認待ち一覧を最新の状態に更新する。

#### エラー処理
- **データ不整合**: 処理しようとした申請が、直前に申請者本人によって取り下げられていた場合、「対象の申請は取り下げられたため、処理できません」等のエラーメッセージを表示する。
- **入力不備**: 却下時にコメントが未入力の場合、「却下理由を入力してください」というエラーメッセージを表示し、処理を中断する。

## データ設計
### データベース構造
#### 休暇申請テーブル (T_LEAVE_APPLICATION) の更新
申請の承認・却下情報を記録するため、既存テーブルに項目を追加する。
| 項目名 | データ型 | 説明 | 主キー |
|---|---|---|---|
| application_id | BIGINT | 申請ID（自動採番） | ○ |
| employee_id | VARCHAR(10) | 申請者の従業員ID | |
| leave_type | VARCHAR(2) | 休暇種別コード | |
| start_date | DATE | 休暇開始日 | |
| end_date | DATE | 休暇終了日 | |
| reason | VARCHAR(255) | 申請理由 | |
| status | VARCHAR(2) | ステータス（01:申請中, 02:承認, 03:却下, 04:取下） | |
| application_timestamp | DATETIME | 申請日時 | |
| **approver_id** | **VARCHAR(10)** | **処理者の従業員ID（NULL許容）** | |
| **approval_timestamp** | **DATETIME** | **処理日時（NULL許容）** | |
| **approver_comment** | **VARCHAR(255)** | **処理者コメント（NULL許容）** | |

## インターフェース設計
### 内部インターフェース
- **サーバー間通信**
  - プロトコル: HTTPS
  - データ形式: JSON
  - エンドポイント例:
    - GET /api/management/approvals/leaves （管理職向けの承認待ち休暇申請一覧取得）
    - POST /api/management/approvals/leaves/{application_id}/approve （休暇申請の承認）
    - POST /api/management/approvals/leaves/{application_id}/reject （休暇申請の却下）

## 非機能要件
### 性能
- 承認待ち一覧の表示: 配下従業員50人分の申請（最大100件）が3秒以内に表示されること。

### セキュリティ
- 管理職は、自身の管理配下にある従業員の申請のみを閲覧・操作できる。権限のない申請データへのアクセスは完全に遮断する。

## テスト計画
### 単体テスト
- 承認、却下処理時に、休暇申請テーブルのステータスや処理者情報が正しく更新されることを確認する。
- 有給休暇承認時に、有給残日数が正しく減算されるロジックを確認する。

### 結合テスト
- 管理職が申請を処理した後、申請者本人に正しい内容（承認/却下、コメント）の通知が届くことを確認する。

### シナリオテスト
- 管理職Aが、管理下にない従業員Bの申請を操作しようとし、権限エラーとなることを確認する。

## 付録
### 用語集
- **承認**: 申請された内容を正当なものとして認めること。
- **却下**: 申請された内容を認めず、差し戻すこと。

### 参考資料
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）