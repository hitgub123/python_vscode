
# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要
本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、監査ログ管理機能について定義する。

## 要件定義
### 要件一覧
| ID | 分類 | 要件名 | 概要 | 利用者 |
|---|---|---|---|---|
| req-031 | セキュリティ・データ管理 | 監査ログ管理 | すべての操作履歴（打刻、申請、承認、データ変更など）が監査ログとして記録され、必要に応じて追跡・確認できる。 | システム管理者, 人事部門 |

## 機能設計
### 監査ログ管理機能 (req-031)
#### 機能概要
システム内のすべての操作履歴を記録し、システム管理者および人事部門が必要に応じて追跡・確認できる機能を提供する。  記録対象は、打刻、申請、承認、データ変更など、システムに対するあらゆる操作とする。

#### 入力仕様
- **操作種別**: システム内で発生した操作の種類（例：ログイン、ログアウト、打刻、休暇申請、承認など）。
- **操作日時**: 操作が実行された日時。
- **ユーザーID**: 操作を実行したユーザーのID。
- **IPアドレス**: 操作が実行された端末のIPアドレス。
- **詳細情報**: 操作に関する詳細な情報（例：変更されたデータの内容、申請内容の詳細など）。

#### 出力仕様
- **ログデータ**:
  - システム内のデータベースまたは専用のログファイルに、上記の入力仕様に沿った形式で記録される。
- **検索画面**:
  - システム管理者は、特定の期間、ユーザー、操作種別などを指定して、監査ログを検索できる画面を提供する。
- **エクスポート機能**:
  - 検索結果をCSV形式などでエクスポートする機能を提供する。

#### 処理フロー
1.  システム内で何らかの操作（打刻、申請、承認、データ変更など）が発生する。
2.  監査ログ記録モジュールが、操作種別、操作日時、ユーザーID、IPアドレス、詳細情報などの必要な情報を収集する。
3.  収集された情報を、監査ログテーブルに新規レコードとして登録する。
4.  システム管理者が監査ログ検索画面から検索条件を入力し、検索を実行する。
5.  システムは、入力された検索条件に合致する監査ログデータをデータベースから抽出し、検索結果として画面に表示する。
6.  システム管理者は、必要に応じて検索結果をCSV形式などでエクスポートする。

#### エラー処理
- **ログ記録失敗**: 監査ログの記録に失敗した場合（例：データベースへの書き込みエラー）、<span style="color:red">エラーログを出力し、システム管理者に通知する。操作自体は継続する。</span>
- **検索エラー**: 監査ログの検索時にエラーが発生した場合（例：データベース接続エラー）、<span style="color:red">エラーメッセージを表示し、システム管理者に通知する。</span>
- **権限エラー**:  システム管理者以外のユーザーが監査ログにアクセスしようとした場合、<span style="color:red">アクセス拒否のエラーメッセージを表示する。</span>

## データ設計
### データベース構造
#### 【新規】監査ログテーブル (T_AUDIT_LOG)
| 項目名 | データ型 | 説明 | 主キー |
|---|---|---|---|
| log_id | BIGINT | ログID（自動採番） | ○ |
| operation_type | VARCHAR(50) | 操作種別（例：LOGIN, LOGOUT, STAMP, LEAVE_APPLICATION） | |
| operation_timestamp | DATETIME | 操作日時 | |
| user_id | VARCHAR(10) | ユーザーID | |
| ip_address | VARCHAR(20) | IPアドレス | |
| detail | TEXT | 詳細情報（JSON形式で保存） | |

## インターフェース設計
### 内部インターフェース
- **ログ記録モジュールと各機能モジュール間**
  - 監査ログ記録モジュールは、各機能モジュールからイベントを受け取るためのAPIを提供する。
  - プロトコル: 内部API (例: Java Message Service (JMS) など)
  - データ形式: JSON
- **監査ログ検索画面とデータベース間**
  - プロトコル: JDBC
  - クエリ例: `SELECT * FROM T_AUDIT_LOG WHERE operation_timestamp BETWEEN ? AND ? AND user_id = ?`

## 非機能要件
### 性能
- ログ記録処理: 各操作の完了後、0.5秒以内に完了すること。
- 監査ログ検索: 1000件のログを検索するのに5秒以内に完了すること。

### セキュリティ
- 監査ログデータへのアクセスは、システム管理者および人事部門のみに限定する。
- 監査ログデータは暗号化して保存する。
- 監査ログへの不正アクセスを検知する仕組みを導入する。

## テスト計画
### 単体テスト
- 各機能（打刻、申請、承認など）が実行された際に、監査ログが正しく記録されることを確認する。
- 監査ログの記録内容が、操作種別、操作日時、ユーザーID、IPアドレス、詳細情報などを正確に含んでいることを確認する。
- 大量のログデータが記録された場合でも、システム全体の性能に影響を与えないことを確認する。

### 結合テスト
- 監査ログ検索画面から、様々な検索条件で監査ログを検索できることを確認する。
- 検索結果が、入力された検索条件に合致する監査ログデータのみを含んでいることを確認する。
- エクスポート機能が正しく動作し、検索結果をCSV形式などでエクスポートできることを確認する。
- セキュリティ要件を満たしていることを確認する。（権限のないユーザーが監査ログにアクセスできないことなど）

## 付録
### 用語集
- **監査ログ**: システム内で発生したすべての操作の履歴を記録したデータ。
- **追跡**: 監査ログを分析し、特定の操作やイベントの原因、影響範囲などを調査すること。

### 参考資料
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）
