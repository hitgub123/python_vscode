# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要
本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。主な機能として、ICカードやスマートフォンアプリを用いた打刻機能を提供し、一般従業員が利用することを想定している。

## 要件定義
### 要件一覧
| ID       | 分類             | 要件名       | 概要                                                                 | 利用者       |
|----------|------------------|--------------|----------------------------------------------------------------------|--------------|
| req-001  | 出退勤記録管理   | 出退勤打刻   | 従業員は、指定された手段（ICカード、スマートフォンアプリなど）を用いて、自身の出社時刻および退社時刻を正確に記録できる。 | 一般従業員   |

## 機能設計
### 出退勤打刻機能 (req-001)
#### 機能概要
従業員がICカードまたはスマートフォンアプリを使用して、出社および退社時刻を記録する機能を提供する。打刻データはリアルタイムでサーバーに送信され、正確な時刻管理を行う。

#### 入力仕様
- **ICカード打刻**
  - カードリーダーにICカードをかざす。
  - カードIDと打刻時刻（出社/退社）をシステムに送信。
- **スマートフォンアプリ打刻**
  - アプリ上で「出社」または「退社」ボタンを押下。
  - ユーザー認証（ログインID、パスワード、または生体認証）後、打刻時刻を送信。
- **共通**
  - 打刻時刻：システム時刻（JST）を基準に記録。
  - 打刻種別：出社/退社を識別。

#### 出力仕様
- 打刻完了後、利用者に以下を通知：
  - 打刻時刻
  - 打刻種別（出社/退社）
  - 処理結果（成功/失敗）
- 通知方法：
  - ICカード：カードリーダー画面表示および音声通知
  - スマートフォンアプリ：プッシュ通知および画面表示

#### 処理フロー
1. 利用者がICカードまたはアプリで打刻操作を行う。
2. システムが利用者の認証を行う（カードIDまたはログイン情報）。
3. 認証成功後、打刻時刻と種別をサーバーに送信。
4. サーバーがデータをデータベースに保存。
5. 利用者に処理結果を通知。

#### エラー処理
- **認証失敗**：エラーメッセージを表示（例：「カードが無効です」「ログイン情報が正しくありません」）。
- **通信エラー**：オフラインモードで一時保存し、後で同期。
- **時刻異常**：システム時刻が取得できない場合、エラーログを記録し管理者通知。

## データ設計
### データベース構造
#### 打刻履歴テーブル (T_ATTENDANCE_LOG)
| 項目名            | データ型       | 説明                              | 主キー |
|-------------------|----------------|-----------------------------------|--------|
| log_id            | BIGINT         | 打刻ログID（自動採番）           | ○      |
| employee_id        | VARCHAR(10)    | 従業員ID                         |        |
| timestamp         | DATETIME       | 打刻時刻（JST）                  |        |
| attendance_type   | VARCHAR(2)     | 打刻種別（出社:01/退社:02）     |        |
| device_type       | VARCHAR(2)     | デバイス種別（IC:01/アプリ:02）  |        |

## インターフェース設計
### 外部インターフェース
- **ICカードリーダー**
  - プロトコル：NFC（FeliCa対応）
  - データ形式：カードID（16バイト）
- **スマートフォンアプリ**
  - OS：iOS 15以上、Android 10以上
  - API：RESTful API（JSON形式）
  - 認証：JWTトークン

### 内部インターフェース
- **サーバー間通信**
  - プロトコル：HTTPS
  - データ形式：JSON
  - エンドポイント例：
    - POST /api/attendance/log（打刻データ登録）

## 非機能要件
### 性能
- 打刻処理：1秒以内に完了
- 同時打刻：最大500人/分

### 可用性
- 稼働率：99.9%
- メンテナンス時間：毎月第2日曜 0:00-3:00

### セキュリティ
- データ暗号化：TLS 1.3
- 認証：多要素認証（アプリの場合）
- ログ監視：不正アクセス検知

## テスト計画
### 単体テスト
- 各コンポーネント（ICカード認証、アプリ認証、データ保存）の動作確認。
### 結合テスト
- ICカードとアプリの打刻データが同一DBに正しく保存されることを確認。
### 負荷テスト
- 500人同時打刻時のレスポンスタイムを測定。

## 運用・保守
### 運用体制
- サポート窓口：平日9:00-17:00
- 障害対応：24時間365日（緊急時）
### 保守内容
- 月次パッチ適用
- 年次システムアップデート

## 付録
### 用語集
- 打刻：出社または退社時刻を記録する行為
- ICカード：NFC対応の従業員証
- アプリ：出退勤管理用スマートフォンアプリケーション

### 参考資料
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）