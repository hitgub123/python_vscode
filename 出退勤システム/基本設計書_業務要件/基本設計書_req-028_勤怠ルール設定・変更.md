
# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要
本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、人事部門が勤怠ルールを設定・変更する機能について定義する。

## 要件定義
### 要件一覧
| ID | 分類 | 要件名 | 概要 | 利用者 |
|---|---|---|---|---|
| req-028 | システム管理 | 勤怠ルール設定・変更 | 人事部門は、就業規則に基づく勤務時間（定時、休憩時間）、休日、各種休暇制度、残業に関するルールなどをシステムに設定できる。 | 人事部門 |

## 機能設計
### 勤怠ルール設定・変更機能 (req-028)

#### 機能概要
人事部門が、Webアプリケーションを通じて、勤務時間、休憩時間、休日、各種休暇制度、残業に関するルールなどをシステムに設定・変更する機能を提供する。

#### 入力仕様
- **Webアプリケーション**
  - **勤務時間設定**:
    - 定時開始時間 (HH:MM)
    - 定時終了時間 (HH:MM)
    - 所定労働時間 (時間)
  - **休憩時間設定**:
    - 休憩開始時間 (HH:MM)
    - 休憩終了時間 (HH:MM)
    - 休憩時間 (分)
  - **休日設定**:
    - 休日種別 (選択式：曜日指定、日付指定)
    - 曜日 (曜日指定の場合)
    - 日付 (日付指定の場合、複数指定可能)
  - **休暇制度設定**:
    - 休暇種別 (選択式：有給休暇、夏季休暇、年末年始休暇、慶弔休暇など)
    - 付与日数 (日数)
    - 付与条件 (入社からの経過月数など)
  - **残業ルール設定**:
    - 残業時間上限 (時間/月)
    - 深夜残業時間 (22:00～05:00) の割増率 (%)
    - 法定内残業、法定外残業の割増率 (%)
    - フレックスタイム制の清算期間、コアタイム時間

#### 出力仕様
- **画面表示**
  - 設定完了後、「勤怠ルールを更新しました。」等の完了メッセージを表示する。
  - 設定内容一覧画面で、設定された勤怠ルールを確認できる。

#### 処理フロー
1. 人事部門担当者がシステムにログインし、勤怠ルール設定画面を開く。
2. 人事部門担当者が、勤務時間、休憩時間、休日、各種休暇制度、残業に関するルールなどを入力し、「保存」ボタンを押下する。
3. システムが入力内容の妥当性チェックを行う（例：時間の矛盾、数値の範囲）。
4. チェックOKの場合、入力内容を勤怠ルール設定テーブルに保存する。
5. システムが、変更履歴を記録する（変更日時、変更者、変更内容）。
6. 人事部門担当者の画面に、処理完了メッセージを表示する。

#### エラー処理
- **入力不備**: 必須項目が未入力の場合や、時間の前後関係が不正な場合（例：定時開始時間＞定時終了時間）、<span style="color:red">エラーメッセージを表示し再入力を促す。</span>
- **数値範囲**: 数値項目の入力値が、許容範囲を超えている場合、<span style="color:red">「入力された数値が範囲外です。」等のエラーメッセージを表示し、入力を制限する。</span>
- **データ整合性**: 既存のデータとの整合性が取れない場合（例：過去の勤怠データと矛盾する設定）、<span style="color:red">「過去のデータとの整合性が取れません。設定を見直してください。」等のエラーメッセージを表示する。</span>

## データ設計
### データベース構造
#### 【新規】勤怠ルール設定テーブル (T_ATTENDANCE_RULE)
| 項目名 | データ型 | 説明 | 主キー |
|---|---|---|---|
| rule_id | BIGINT | ルールID（自動採番） | ○ |
| rule_name | VARCHAR(50) | ルール名（例：定時勤務時間、休憩時間） | |
| rule_value | VARCHAR(255) | ルール値（設定値） | |
| rule_type | VARCHAR(2) | ルール種別コード（01:勤務時間, 02:休憩時間, 03:休日, 04:休暇, 05:残業） | |
| valid_from | DATE | 適用開始日 | |
| valid_to | DATE | 適用終了日 | |
| created_timestamp | DATETIME | 作成日時 | |
| updated_timestamp | DATETIME | 更新日時 | |
| updated_by | VARCHAR(10) | 更新者（人事担当者ID） | |

## インターフェース設計
### 内部インターフェース
- **サーバー間通信**
  - プロトコル: HTTPS
  - データ形式: JSON
  - エンドポイント例:
    - POST /api/rules （勤怠ルール登録）
    - PUT /api/rules/{rule_id} （勤怠ルール更新）
    - GET /api/rules （勤怠ルール取得）

## 非機能要件
### 性能
- 勤怠ルール設定処理: 3秒以内に完了すること。
- 設定内容一覧表示: 100件の表示が3秒以内に完了すること。

### セキュリティ
- 勤怠ルール設定・変更は、人事部門の担当者のみ可能とする。
- 設定データは暗号化して保存する。
- 操作履歴を記録し、不正アクセスを監視する。

## テスト計画
### 単体テスト
- 勤怠ルール設定画面の入力バリデーション（必須項目、数値範囲）が正しく機能することを確認する。
- 設定データが勤怠ルール設定テーブルに正しく保存されることを確認する。
- データ整合性チェックが正しく機能することを確認する。

### 結合テスト
- 設定された勤怠ルールが、従業員の勤怠データに正しく反映されることを確認する。
- 休暇申請時に、設定された休暇制度が正しく適用されることを確認する。
- 残業時間計算が、設定された残業ルールに基づいて正しく計算されることを確認する。

## 付録
### 用語集
- **勤怠ルール**: 勤務時間、休憩時間、休日、休暇、残業などに関するルール。
- **割増率**: 残業時間や深夜労働に対して、通常賃金に上乗せされる賃金の割合。

### 参考資料
- 就業規則
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）
