# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要
本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、システム管理者による打刻デバイス管理機能について定義する。

## 要件定義
### 要件一覧
| ID | 分類 | 要件名 | 概要 | 利用者 |
|---|---|---|---|---|
| req-029 | システム管理 | 打刻デバイス管理 | システム管理者は、打刻に利用するICカードリーダーやスマートフォンアプリ設定など、打刻デバイスの管理を行える。 | システム管理者 |

## 機能設計
### 打刻デバイス管理機能 (req-029)
#### 機能概要
システム管理者が、Webアプリケーションを通じて、打刻に利用するICカードリーダーやスマートフォンアプリの設定などの管理を行う機能を提供する。

#### 入力仕様
- **Webアプリケーション**
  - **デバイス種別**: 選択式（例：ICカードリーダー、スマートフォンアプリ）
  - **デバイスID**: テキスト入力（デバイス固有のID）
  - **デバイス名**: テキスト入力（デバイスの表示名）
  - **状態**: 選択式（有効、無効）
  - **設置場所**: テキスト入力（任意）
  - **設定情報**: テキスト入力（JSON形式など、デバイス種別によって異なる）

#### 出力仕様
- **画面表示**
  - デバイス一覧画面：登録されているデバイスの一覧を表示する。
  - デバイス詳細画面：選択されたデバイスの詳細情報を表示・編集する。
  - 登録完了後、「打刻デバイスを登録しました。」等の完了メッセージを表示する。
- **データ更新**
  - 設定変更後、各打刻デバイスに設定情報が反映される。

#### 処理フロー
1. システム管理者がシステムにログインし、打刻デバイス管理画面を開く。
2. システム管理者は、新規デバイス登録、既存デバイス編集、デバイス削除のいずれかを選択する。
3. **新規デバイス登録の場合:**
   1. デバイス種別、デバイスID、デバイス名、状態、設置場所、設定情報等の必要項目を入力する。
   2. 「登録」ボタンを押下する。
   3. システムが入力内容の妥当性チェックを行う（例：必須項目の入力、IDの重複）。
   4. チェックOKの場合、デバイス情報をデータベースに保存する。
   5. システムが、各打刻デバイスに設定情報を反映させる処理を実行する。
   6. 処理完了メッセージを表示する。
4. **既存デバイス編集の場合:**
   1. デバイス一覧から編集対象のデバイスを選択する。
   2. デバイス詳細画面で、必要な項目を編集する。
   3. 「更新」ボタンを押下する。
   4. システムが入力内容の妥当性チェックを行う。
   5. チェックOKの場合、データベースのデバイス情報を更新する。
   6. システムが、各打刻デバイスに設定情報を反映させる処理を実行する。
   7. 処理完了メッセージを表示する。
5. **デバイス削除の場合:**
   1. デバイス一覧から削除対象のデバイスを選択する。
   2. 確認画面で削除を実行する。
   3. システムがデータベースからデバイス情報を削除する。

#### エラー処理
- **入力不備**: 必須項目が未入力の場合や、入力形式が不正な場合（例：デバイスIDの形式）、エラーメッセージを表示し再入力を促す。
- **ID重複**: デバイスIDが既に登録されている場合、「指定されたデバイスIDは既に存在します。」等のエラーメッセージを表示し、別のIDの入力を促す。
- **データベースエラー**: データベースへの保存、更新、削除処理中にエラーが発生した場合、<span style="color:red;">「データベースエラーが発生しました。システム管理者に連絡してください。」</span>等のエラーメッセージを表示する。
- **設定反映エラー**: 各打刻デバイスへの設定反映処理に失敗した場合、<span style="color:red;">「設定反映に失敗しました。デバイスの状態を確認してください。」</span>等のエラーメッセージを表示する。

## データ設計
### データベース構造
#### 【新規】打刻デバイス管理テーブル (T_ATTENDANCE_DEVICE)
| 項目名 | データ型 | 説明 | 主キー |
|---|---|---|---|
| device_id | VARCHAR(32) | デバイスID | ○ |
| device_type | VARCHAR(2) | デバイス種別コード（01:ICカードリーダー, 02:スマートフォンアプリ） | |
| device_name | VARCHAR(64) | デバイス名 | |
| status | VARCHAR(2) | 状態（01:有効, 02:無効） | |
| location | VARCHAR(255) | 設置場所 | |
| configuration | TEXT | 設定情報（JSON形式） | |
| created_at | DATETIME | 登録日時 | |
| updated_at | DATETIME | 更新日時 | |

## インターフェース設計
### 内部インターフェース
- **サーバー間通信**
  - プロトコル: HTTPS
  - データ形式: JSON
  - エンドポイント例:
    - POST /api/admin/devices （新規デバイス登録）
    - GET /api/admin/devices （デバイス一覧取得）
    - GET /api/admin/devices/{device_id} （デバイス詳細取得）
    - PUT /api/admin/devices/{device_id} （デバイス情報更新）
    - DELETE /api/admin/devices/{device_id} （デバイス削除）

### 外部インターフェース
- 各打刻デバイスとの通信：デバイス種別によって異なるプロトコル、データ形式を用いる。

## 非機能要件
### 性能
- デバイス登録・更新処理: 2秒以内に完了すること。
- デバイス一覧表示: 100件のデバイス情報を3秒以内に表示すること。

### セキュリティ
- 本機能へのアクセスは、システム管理者権限を持つユーザーのみに制限する。
- デバイス設定情報は暗号化して保存する。
- 各打刻デバイスとの通信は、セキュリティで保護されたプロトコルを使用する。

## テスト計画
### 単体テスト
- 打刻デバイス管理画面の入力バリデーション（必須項目、ID重複チェック）が正しく機能することを確認する。
- デバイス情報が打刻デバイス管理テーブルに正しく保存・更新・削除されることを確認する。
- 設定情報の形式が正しいJSON形式であることを検証する。

### 結合テスト
- デバイス登録後、各打刻デバイスに設定情報が正しく反映されることを確認する。
- 打刻デバイスから送信されたデータが、システムに正しく記録されることを確認する。
- 状態（有効/無効）の切り替えが、打刻デバイスの動作に正しく反映されることを確認する。

## 付録
### 用語集
- **打刻デバイス**: 従業員が出退勤時刻を記録するために使用する機器（ICカードリーダー、スマートフォンアプリなど）。

### 参考資料
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）
