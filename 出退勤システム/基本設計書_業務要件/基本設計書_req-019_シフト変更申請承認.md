はい、 START OF FILE 基本設計書*req-019*シフト変更申請承認.md ---

# 基本設計書

## ドキュメント概要

本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本 IT 業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要

本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、従業員によるシフト変更申請と管理職による承認/却下機能について定義する。

## 要件定義

### 要件一覧

| ID      | 分類       | 要件名             | 概要                                                                                             | 利用者             |
| ------- | ---------- | ------------------ | ------------------------------------------------------------------------------------------------ | ------------------ |
| req-019 | シフト管理 | シフト変更申請承認 | シフト変更が必要な場合、従業員はオンラインで変更申請を行い、管理職はそれを承認または却下できる。 | 一般従業員, 管理職 |

## 機能設計

### シフト変更申請承認機能 (req-019)

#### 機能概要

一般従業員が、Web アプリケーションまたはスマートフォンアプリを通じて、シフト変更の申請を行う機能を提供する。申請された内容は、管理職へ通知され、承認または却下の判断を行うことができる。

#### 入力仕様

- **Web/スマートフォンアプリ共通**

  - **申請者**: 自動的にログインユーザーの従業員 ID が設定される。
  - **変更希望日**: カレンダー形式で日付を選択 (YYYY-MM-DD)。
  - **変更希望時間帯**: 時間帯を選択（例：開始時刻 - 終了時刻）。
  - **変更理由**: テキスト入力（必須）。
  - **現行シフト**: 変更希望日の現行シフトを表示（参照のみ）。

- **管理職画面**
  - **承認/却下**: 申請内容を確認後、承認または却下を選択する。
  - **却下理由**: 却下を選択した場合、理由をテキスト入力（必須）。

#### 出力仕様

- **従業員画面**
  - 申請完了後、「シフト変更申請を受け付けました。」等の完了メッセージを表示する。
  - 自身の申請履歴一覧画面で、申請状況（申請中、承認、却下）を確認できる。
- **管理職画面**
  - 未承認の申請一覧を表示する。
  - 承認/却下処理後、申請者に結果を通知する。
- **通知**
  - 申請完了時、申請内容が管理職へメール等の手段で通知される。
  - 管理職が承認/却下した場合、申請者へ結果がメール等の手段で通知される。

#### 処理フロー

1. 従業員がシステムにログインし、シフト変更申請画面を開く。
2. 従業員が変更希望日、時間帯、理由等の必要項目を入力し、「申請」ボタンを押下する。
3. システムが入力内容の妥当性チェックを行う。
4. チェック OK の場合、申請内容をシフト変更申請テーブルに「申請中」ステータスで保存する。
5. システムが、設定されたワークフローに基づき、管理職へ申請があった旨を通知する。
6. 申請者の画面に、処理完了メッセージを表示する。
7. 管理職がシステムにログインし、未承認の申請一覧から該当の申請を選択する。
8. 管理職が申請内容を確認し、承認または却下を選択する。
9. 却下の場合、却下理由を入力する。
10. システムが承認/却下の結果をシフト変更申請テーブルに保存する。
11. システムが、申請者へ承認/却下の結果を通知する。

#### エラー処理

- **入力不備**: 必須項目が未入力の場合、<span style="color:red;">エラーメッセージを表示し再入力を促す。</span>
- **日付の矛盾**: 過去の日付で申請した場合、<span style="color:red;">「過去の日付は選択できません。」等のエラーメッセージを表示する。</span>
- **時間帯の矛盾**: 申請時間が現行シフトと重複する場合、<span style="color:red;">「選択された時間帯は現行シフトと重複しています。」等のエラーメッセージを表示する。</span>
- **二重申請**: 同一日に既にシフト変更申請が存在する場合、<span style="color:red;">「指定された日には既に申請が存在します。」等のエラーメッセージを表示する。</span>
- **管理職が却下理由を入力しなかった場合**: <span style="color:red;">「却下理由を入力してください。」というエラーメッセージを表示する。</span>

## データ設計

### データベース構造

#### 【新規】シフト変更申請テーブル (T_SHIFT_CHANGE_APPLICATION)

| 項目名                | データ型     | 説明                                      | 主キー |
| --------------------- | ------------ | ----------------------------------------- | ------ |
| application_id        | BIGINT       | 申請 ID（自動採番）                       | ○      |
| employee_id           | VARCHAR(10)  | 申請者の従業員 ID                         |        |
| request_date          | DATE         | 変更希望日                                |        |
| request_start_time    | TIME         | 変更希望開始時間                          |        |
| request_end_time      | TIME         | 変更希望終了時間                          |        |
| reason                | VARCHAR(255) | 申請理由                                  |        |
| status                | VARCHAR(2)   | ステータス（01:申請中, 02:承認, 03:却下） |        |
| application_timestamp | DATETIME     | 申請日時                                  |        |
| approval_timestamp    | DATETIME     | 承認/却下日時                             |        |
| approver_employee_id  | VARCHAR(10)  | 承認者の従業員 ID                         |        |
| rejection_reason      | VARCHAR(255) | 却下理由                                  |        |

## インターフェース設計

### 内部インターフェース

- **サーバー間通信**
  - プロトコル: HTTPS
  - データ形式: JSON
  - エンドポイント例:
    - POST /api/shifts/applications （シフト変更申請データ登録）
    - GET /api/shifts/applications （自身のシフト変更申請履歴取得）
    - PUT /api/shifts/applications/{application_id}/approval （シフト変更申請承認）
    - PUT /api/shifts/applications/{application_id}/rejection （シフト変更申請却下）

## 非機能要件

### 性能

- シフト変更申請処理: 2 秒以内に完了すること。
- 申請履歴表示: 50 件の表示が 2 秒以内に完了すること。
- 管理職の未承認申請一覧表示: 2 秒以内に完了すること。

### セキュリティ

- 従業員は自身のシフト変更申請・閲覧のみ可能とし、他従業員の申請データへのアクセスは不可とする。
- 管理職は、管轄下の従業員の申請のみ承認/却下可能とする。
- 承認/却下時の操作ログを記録する。

## テスト計画

### 単体テスト

- シフト変更申請画面の入力バリデーション（必須項目、日付、時間帯の妥当性）が正しく機能することを確認する。
- 申請データがシフト変更申請テーブルに正しく保存されることを確認する。
- 管理職が承認/却下処理を行った際に、ステータスが正しく更新されることを確認する。

### 結合テスト

- 従業員が申請後、設定された管理職に正しく通知が飛ぶことを確認する。
- 承認/却下後、申請者に結果が正しく通知されることを確認する。

## 付録

### 用語集

- **シフト変更申請**: 従業員が事前に定められたシフトの変更を希望し、承認を求める手続き。
- **管轄**: 管理職が責任を持つ従業員の範囲。

### 参考資料

- 日本 IT 業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025 年 6 月版）

