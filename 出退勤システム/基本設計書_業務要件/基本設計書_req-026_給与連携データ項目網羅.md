START OF FILE 基本設計書*req-026*給与連携データ項目網羅.md ---

# 基本設計書

## ドキュメント概要

本基本設計書は、出退勤システムの要件に基づき、給与システムとの連携機能に関する基本設計を定義するものである。日本 IT 業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要

本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、給与システムとの連携機能について定義する。

## 要件定義

### 要件一覧

| ID      | 分類                 | 要件名                 | 概要                                                                                             | 利用者   |
| ------- | -------------------- | ---------------------- | ------------------------------------------------------------------------------------------------ | -------- |
| req-026 | 給与システムとの連携 | 給与連携データ項目網羅 | 連携された勤怠データは、給与計算に必要なすべての項目を含み、手動でのデータ入力作業を不要にする。 | 経理部門 |

## 機能設計

### 給与連携データ作成機能 (req-026)

#### 機能概要

出退勤システムで記録された勤怠データを、給与計算システムで利用可能な形式に変換し、連携するための機能を提供する。経理部門は、このデータを用いて給与計算を効率的に行うことができる。

#### 入力仕様

- **システム内部データ**
  - 従業員 ID
  - 出勤日
  - 退勤日
  - 労働時間
  - 休憩時間
  - 遅刻時間
  - 早退時間
  - 欠勤時間
  - 休日出勤時間
  - 深夜労働時間
  - 各種休暇日数（有給、慶弔など）
  - 残業時間 (通常残業、深夜残業)
  - その他（会社固有の項目があれば定義）

#### 出力仕様

- **ファイル出力**
  - ファイル形式: CSV, XML, または給与システムが指定する形式
  - ファイル名: `attendance_data_YYYYMMDD.csv` (例: attendance_data_20240715.csv)
  - ファイル内容: 各従業員の勤怠データを、給与システムが求める形式で出力
- **連携方法**:
  - FTP サーバへのファイルアップロード
  - API 連携（給与システムが API を提供している場合）

#### 処理フロー

1.  システム管理者またはスケジュールされたバッチ処理により、指定された期間の勤怠データが収集される。
2.  収集されたデータは、給与システムが要求するデータ形式に変換される。
3.  変換されたデータは、指定されたファイル形式で出力される。
4.  出力されたファイルは、FTP サーバにアップロードされるか、API を通じて給与システムに送信される。
5.  処理結果（成功/失敗）のログが出力される。

#### エラー処理

- **データ不整合**: 勤怠データに矛盾がある場合 (例: 退勤時間が勤務時間より早い)、エラーログを出力し、経理部門に通知する。<span style="color:red;">（エラーログ例: 従業員 ID:XXXX, 日付:YYYYMMDD, 退勤時間が勤務時間より早いです。）</span>
- **ファイル出力失敗**: ファイル出力時にエラーが発生した場合 (例: ディスク容量不足)、エラーログを出力し、システム管理者に通知する。<span style="color:red;">（エラーログ例: ファイル出力先ディレクトリに書き込み権限がありません。）</span>
- **FTP アップロード失敗/API 送信失敗**: FTP サーバへのアップロードまたは API 送信に失敗した場合、エラーログを出力し、システム管理者に通知する。<span style="color:red;">（エラーログ例: FTP サーバに接続できませんでした。）</span>
- **データ型不一致**: 給与システムが求めるデータ型と異なる場合、変換処理でエラーが発生し、エラーログを出力する。<span style="color:red;">（エラーログ例: 従業員 ID のデータ型が不正です。数値であるべきです。）</span>

## データ設計

### データマッピング

| 出退勤システム項目     | 給与システム項目        | データ型     | 説明                |
| ---------------------- | ----------------------- | ------------ | ------------------- |
| employee_id            | employee_code           | VARCHAR(10)  | 従業員コード        |
| work_date              | payroll_date            | DATE         | 勤務日              |
| work_time              | actual_work_hours       | DECIMAL(5,2) | 実労働時間 (時間)   |
| break_time             | break_hours             | DECIMAL(5,2) | 休憩時間 (時間)     |
| late_time              | late_hours              | DECIMAL(5,2) | 遅刻時間 (時間)     |
| early_leave_time       | early_leave_hours       | DECIMAL(5,2) | 早退時間 (時間)     |
| absence_time           | absence_hours           | DECIMAL(5,2) | 欠勤時間 (時間)     |
| holiday_work_time      | holiday_work_hours      | DECIMAL(5,2) | 休日出勤時間 (時間) |
| midnight_work_time     | midnight_work_hours     | DECIMAL(5,2) | 深夜労働時間 (時間) |
| paid_leave_days        | paid_leave_days         | DECIMAL(3,1) | 有給休暇日数        |
| overtime_time          | overtime_hours          | DECIMAL(5,2) | 残業時間 (時間)     |
| midnight_overtime_time | midnight_overtime_hours | DECIMAL(5,2) | 深夜残業時間 (時間) |

## インターフェース設計

### 外部インターフェース

- **給与システムとの連携**
  - 連携方式:
    - ファイル連携 (FTP)
      - プロトコル: FTP/SFTP
      - ファイル形式: 給与システム指定形式 (CSV, XML など)
      - ファイル転送先: 給与システムが指定する FTP サーバ
    - API 連携
      - プロトコル: HTTPS
      - データ形式: JSON/XML
      - エンドポイント: 給与システムが提供する API エンドポイント

## 非機能要件

### 性能

- データ連携処理: 従業員数 1000 人分のデータ連携処理が 10 分以内に完了すること。
- ファイル生成処理：1000 人分のデータが５分以内に生成できること。

### セキュリティ

- FTP サーバへのアクセスは、専用のアカウントを使用し、アクセス権を制限する。
- API 連携の場合は、OAuth 2.0 などの認証メカニズムを使用し、セキュリティを確保する。
- 連携データは暗号化して送受信する (HTTPS, SFTP など)。

## テスト計画

### 単体テスト

- 勤怠データが正しく給与システム形式に変換されることを確認する。
- エラーデータが含まれる場合に、エラー処理が正しく動作することを確認する。
- ファイルが指定された場所に正しく出力されることを確認する。
- 連携データが給与システムに正常に連携されることを確認する (FTP アップロード/API 送信)。

### 結合テスト

- 出退勤システムの勤怠データが、給与システムへ正確に連携され、給与計算が正常に行われることを確認する。
- 連携処理の性能が、非機能要件を満たしていることを確認する。
- 異常データに対するエラー処理が、運用に支障がないレベルで機能することを確認する。

## 付録

### 用語集

- **給与連携**: 出退勤システムで記録された勤怠データを、給与計算システムに連携する処理。
- **FTP**: ファイル転送プロトコル (File Transfer Protocol)。
- **API**: アプリケーションプログラミングインターフェース (Application Programming Interface)。

### 参考資料

- 給与システム連携仕様書 (給与システムベンダ提供)
- 出退勤システム要件定義書（2024 年 7 月版）

