# 基本設計書

## ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

| ID | 作成者 | 作成日付 |
|---|---|---|
| req-013 | カエルXX | 2024-05-24 |

## システム概要
本システムは、従業員の勤怠を管理するシステムの一部として、残業申請の承認機能を提供する。管理職は本機能を利用し、部下からの残業申請を審査する。

## 要件定義
### 要件一覧
| ID | 分類 | 要件名 | 概要 | 利用者 |
|---|---|---|---|---|
| req-013 | 残業管理 | 残業申請承認 | 管理職は、部下から提出された残業申請を審査し、承認または却下することができる。 | 管理職 |

## 機能設計
### 残業申請承認機能 (req-013)
#### 機能概要
管理職が、Web管理画面から配下の従業員より申請された残業内容を確認し、承認または却下処理を行う機能を提供する。

#### 入力仕様
- 承認待ちの残業申請一覧から、処理対象の申請を選択する。
- 「承認」または「却下」ボタンを押下する。
- 却下時には、理由をコメントとして入力することを必須とする。

#### 出力仕様
- 処理完了後、申請者本人に結果（承認/却下およびコメント）を通知する。
- 画面に「承認しました」「却下しました」等の完了メッセージを表示する。

#### 処理フロー
1. 管理職が管理画面にログインし、承認ワークフロー画面を開く。
2. 自身の管理配下から提出された「申請中」の残業申請が一覧表示される。
3. 内容を確認し、「承認」または「却下」（コメント入力必須）ボタンを押下する。
4. システムが残業申請テーブルのステータスを更新し、処理者IDやコメント、処理日時を記録する。
5. 申請者本人へ処理結果を通知する。

#### エラー処理
- **入力不備**: 却下時にコメントが未入力の場合、「却下理由を入力してください」というエラーメッセージを表示する。
- **データ不整合**: <font color="red">処理しようとした申請が、直前に申請者本人によって取り下げられていた場合、「対象の申請は取り下げられたため、処理できません」等のエラーメッセージを表示する。</font>

## データ設計
### データベース構造
#### 残業申請テーブル (T_OVERTIME_APPLICATION) の更新
承認処理に伴い、以下の項目にデータが記録される。
| 項目名 | データ型 | 説明 |
|---|---|---|
| ... | ... | ... |
| status | VARCHAR(2) | ステータスを「承認(02)」または「却下(03)」に更新 |
| **approver_id** | **VARCHAR(10)** | **処理を行った管理者の従業員ID** |
| **approval_timestamp** | **DATETIME** | **処理日時** |
| **approver_comment** | **VARCHAR(255)** | **処理者コメント（却下時必須）** |

## インターフェース設計
### 内部インターフェース
- **APIエンドポイント例**:
  - `GET /api/management/approvals/overtime` (承認待ち一覧取得)
  - `POST /api/management/approvals/overtime/{id}/approve` (承認処理)
  - `POST /api/management/approvals/overtime/{id}/reject` (却下処理)

## 非機能要件
### セキュリティ
- 管理職は、自身の管理配下にある従業員の申請のみを閲覧・操作できる。

## テスト計画
### 結合テスト
- 管理職が申請を処理した後、申請者本人に正しい内容の通知が届くことを確認する。

## 付録
### 用語集
- **承認**: 申請された内容を正当なものとして認めること。
- **却下**: 申請された内容を認めず、差し戻すこと。
