
# 基本設計書

## ドキュメント概要

本基本設計書は、出退勤システムの要件に基づき、法令遵守レポート自動生成機能の基本設計を定義するものである。日本 IT 業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要

本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、労働基準法やその他の関連法規遵守に必要な各種レポートを自動生成する機能について定義する。

## 要件定義

### 要件一覧

| ID      | 分類                       | 要件名                   | 概要                                                                                                                   | 利用者             |
| ------- | -------------------------- | ------------------------ | ---------------------------------------------------------------------------------------------------------------------- | ------------------ |
| req-023 | 勤怠データの分析・レポート | 法令遵守レポート自動生成 | システムは、労働基準法やその他の関連法規遵守に必要な各種レポート（例：時間外労働集計、休憩取得状況）を自動生成できる。 | 人事部門, 経理部門 |

## 機能設計

### 法令遵守レポート自動生成機能 (req-023)

#### 機能概要

人事部門および経理部門の担当者が、労働基準法などの関連法規遵守状況を把握するためのレポートを自動生成する機能を提供する。

#### 入力仕様

- **レポート種別**: 選択式（例：時間外労働集計レポート、休憩取得状況レポート、有給休暇取得状況レポート）
- **期間**:
  - 開始日 (YYYY-MM-DD)
  - 終了日 (YYYY-MM-DD)
- **対象**:
  - 全従業員
  - 特定の部署
  - 特定の従業員 (従業員 ID 指定)
- **出力形式**: 選択式（例：CSV、PDF）

#### 出力仕様

- **ファイル出力**
  - 指定された形式（CSV または PDF）で、レポートファイルを出力する。
  - ファイル名は、レポート種別、期間、出力日時などを含む命名規則とする。（例：時間外労働集計レポート\_20240701-20240731_202408051000.csv）
- **画面表示**
  - レポート生成状況を示すメッセージを表示する。（例：レポート生成処理を開始しました、レポート生成が完了しました）
  - レポート生成中にエラーが発生した場合、エラーメッセージを表示する。

#### 処理フロー

1. 担当者がシステムにログインし、法令遵守レポート生成画面を開く。
2. 担当者が、レポート種別、期間、対象、出力形式などの必要項目を選択・入力し、「レポート生成」ボタンを押下する。
3. システムが入力内容の妥当性チェックを行う（例：期間の矛盾）。
4. チェック OK の場合、指定された条件に基づき、勤怠データテーブルから必要なデータを抽出する。
5. 抽出したデータに基づいてレポートを生成する。
6. 指定された出力形式でレポートファイルを出力する。
7. レポートファイルの保存場所へのリンクを表示する。
8. 担当者の画面に、処理完了メッセージを表示する。

#### エラー処理

- **入力不備**: 必須項目が未入力の場合や、日付の前後関係が不正な場合（例：開始日＞終了日）、エラーメッセージを表示し再入力を促す。
- **データ不足**: 指定された期間に該当データが存在しない場合、「該当するデータが見つかりませんでした。」等のエラーメッセージを表示する。
- <span style="color:red">**レポート生成失敗**: レポート生成中にシステムエラーが発生した場合、「レポート生成に失敗しました。システム管理者にお問い合わせください。」等のエラーメッセージを表示する。</span>
- <span style="color:red">**権限不足**: 担当者が、レポートを生成する権限を持っていない場合、「この操作を実行する権限がありません。」等のエラーメッセージを表示する。</span>

## データ設計

### データベース構造

- 本機能は既存の勤怠データテーブル (T_ATTENDANCE) および従業員マスタ (M_EMPLOYEE) のデータを利用する。
- レポート生成履歴テーブル (T_REPORT_GENERATION_HISTORY) を新規に作成し、生成されたレポートの情報を記録する。

#### 【新規】レポート生成履歴テーブル (T_REPORT_GENERATION_HISTORY)

| 項目名               | データ型    | 説明                                                      | 主キー |
| -------------------- | ----------- | --------------------------------------------------------- | ------ |
| report_id            | BIGINT      | レポート ID（自動採番）                                   | ○      |
| report_type          | VARCHAR(2)  | レポート種別コード（01:時間外労働, 02:休憩取得状況, ...） |        |
| start_date           | DATE        | 集計開始日                                                |        |
| end_date             | DATE        | 集計終了日                                                |        |
| target_type          | VARCHAR(2)  | 対象種別（01:全従業員, 02:部署, 03:従業員）               |        |
| target_id            | VARCHAR(10) | 対象 ID (部署コードまたは従業員 ID)                       |        |
| output_format        | VARCHAR(3)  | 出力形式 (CSV, PDF)                                       |        |
| generation_timestamp | DATETIME    | レポート生成日時                                          |        |
| generated_by         | VARCHAR(10) | レポート生成者 (従業員 ID)                                |        |

## インターフェース設計

### 内部インターフェース

- **サーバー間通信**
  - プロトコル: HTTPS
  - データ形式: JSON
  - エンドポイント例:
    - POST /api/reports/generate （レポート生成処理開始）
    - GET /api/reports/history （レポート生成履歴取得）

## 非機能要件

### 性能

- レポート生成処理: データ量に応じて、完了までに最大 5 分以内とする。
- レポート生成履歴表示: 50 件の表示が 2 秒以内に完了すること。

### セキュリティ

- レポート生成権限を持つユーザーのみが、レポート生成を実行できるようにする。
- 生成されたレポートファイルへのアクセス権限を、必要な担当者に限定する。
- 個人情報を含むレポートの場合、アクセスログを記録する。

## テスト計画

### 単体テスト

- レポート生成画面の入力バリデーション（必須項目、日付の妥当性）が正しく機能することを確認する。
- 指定された条件に基づき、勤怠データが正しく抽出されることを確認する。
- レポートファイルが指定された形式で正しく生成されることを確認する。

### 結合テスト

- 生成されたレポートの内容が、勤怠データと一致することを確認する。
- レポート生成履歴テーブルに、レポート生成情報が正しく記録されることを確認する。
- 異なるレポート種別、期間、対象、出力形式でテストを実施し、正常に動作することを確認する。

## 付録

### 用語集

- **時間外労働集計レポート**: 従業員ごとの時間外労働時間を集計したレポート。
- **休憩取得状況レポート**: 従業員ごとの休憩取得状況を集計したレポート。
- **有給休暇取得状況レポート**: 従業員ごとの有給休暇取得状況を集計したレポート。

### 参考資料

- 労働基準法
- 出退勤システム要件定義書（2025 年 6 月版）

