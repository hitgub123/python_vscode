```markdown
# 基本設計書

## ドキュメント概要

本基本設計書は、出退勤システムの要件に基づき、残業超過アラート機能の基本設計を定義するものである。日本 IT 業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## システム概要

本システムは、従業員の出退勤時刻を正確に記録・管理し、規定時間を超える残業が発生した場合に管理職および人事部門へアラートを発信する機能を提供する出退勤システムである。

## 要件定義

### 要件一覧

| ID      | 分類     | 要件名           | 概要                                                                                                        | 利用者           |
| ------- | -------- | ---------------- | ----------------------------------------------------------------------------------------------------------- | ---------------- |
| req-015 | 残業管理 | 残業超過アラート | 規定（例：36 協定の限度時間）を超える残業が発生した場合、システムは管理職および人事部門にアラートを発する。 | 管理職, 人事部門 |

## 機能設計

### 残業超過アラート機能 (req-015)

#### 機能概要

従業員の残業時間が規定値を超過した場合に、管理職および人事部門に対してアラートを発信する機能を提供する。アラートは、メール通知およびシステム画面での表示を想定する。

#### 入力仕様

- **残業時間データ**
  - 従業員 ID
  - 残業時間（月間、年間）
  - 規定時間（36 協定の限度時間など、設定ファイルから取得）
- **設定データ**
  - アラート送信先（管理職、人事部門のメールアドレス）
  - アラート基準時間（超過時間を設定可能）
  - アラート送信頻度（日次、週次、月次）

#### 出力仕様

- **アラート通知**
  - メール通知：件名、本文、添付ファイル（該当従業員の残業時間一覧）
  - システム画面表示：アラート一覧画面に表示
- **アラート内容**
  - 従業員 ID
  - 従業員名
  - 超過時間
  - 規定時間
  - 対象期間
  - アラート発生日時

#### 処理フロー

1. システムは、日次、週次、または月次で従業員の残業時間を集計する。
2. 集計された残業時間と規定時間を比較する。
3. 残業時間が規定時間を超過した場合、アラート生成処理を実行する。
4. アラート生成処理は、アラート通知先（管理職、人事部門）へメールを送信し、システム画面にアラートを表示する。
5. アラート履歴をデータベースに保存する。

#### エラー処理

- **メール送信失敗**：<span style="color:red">エラーログを記録し、再送処理を行う。再送回数上限を超えた場合は、システム管理者に通知する。</span>
- **規定時間設定エラー**：<span style="color:red">設定ファイルから規定時間が取得できない場合、エラーログを記録し、アラート処理を中断する。</span>
- **データ集計エラー**：<span style="color:red">残業時間データの集計に失敗した場合、エラーログを記録し、システム管理者に通知する。</span>
- **アラート通知先不明**：<span style="color:red">アラート通知先のメールアドレスが設定されていない場合、エラーログを記録し、アラート処理を中断する。</span>

## データ設計

### データベース構造

#### アラート履歴テーブル (T_OVERTIME_ALERT_LOG)

| 項目名          | データ型     | 説明                                         | 主キー |
| --------------- | ------------ | -------------------------------------------- | ------ |
| alert_id        | BIGINT       | アラート ID（自動採番）                      | ○      |
| employee_id     | VARCHAR(10)  | 従業員 ID                                    |        |
| overtime_hours  | DECIMAL(5,2) | 残業時間                                     |        |
| regulated_hours | DECIMAL(5,2) | 規定時間                                     |        |
| alert_time      | DATETIME     | アラート発生日時                             |        |
| alert_level     | VARCHAR(10)  | アラートレベル（高、中、低）                 |        |
| alert_status    | VARCHAR(2)   | アラートステータス（未対応、対応中、対応済） |        |

#### 設定テーブル (T_SYSTEM_CONFIG)

| 項目名             | データ型     | 説明       | 主キー |
| ------------------ | ------------ | ---------- | ------ |
| config_id          | VARCHAR(20)  | 設定 ID    | ○      |
| config_value       | VARCHAR(255) | 設定値     |        |
| config_description | VARCHAR(255) | 設定の説明 |        |

## インターフェース設計

### 外部インターフェース

- **メールサーバー**
  - プロトコル：SMTP
  - 認証方式：TLS
- **人事システム（連携する場合）**
  - API：RESTful API（JSON 形式）
  - 従業員情報取得、アラート通知状況連携

### 内部インターフェース

- **残業時間集計モジュール**
  - 関数呼び出し：残業時間集計関数
  - 引数：集計対象期間、従業員 ID

## 非機能要件

### 性能

- アラート生成処理：1 時間以内に完了（対象従業員数による）
- メール送信：5 分以内に完了

### 可用性

- 稼働率：99.9%
- アラート監視：24 時間 365 日

### セキュリティ

- データ暗号化：TLS 1.3
- アクセス制御：ロールベースアクセス制御（RBAC）

## テスト計画

### 単体テスト

- 残業時間集計モジュールのテスト
- アラート生成処理のテスト
- メール送信処理のテスト

### 結合テスト

- 残業時間集計からアラート通知までの連携テスト
- 人事システムとの連携テスト（連携する場合）

### 運用テスト

- 実際の設定データを用いて、アラートが正しく通知されるか確認する。

## 運用・保守

### 運用体制

- アラート監視：システム管理者が定期的にアラート状況を確認する。
- 障害対応：24 時間 365 日（緊急時）

### 保守内容

- 月次パッチ適用
- 設定データのメンテナンス

## 付録

### 用語集

- 残業時間：所定労働時間を超えて労働した時間
- 規定時間：36 協定などで定められた残業時間の上限
- アラート：注意を喚起するための通知

### 参考資料

- 36 協定に関する資料
- 関連システムの要件定義書
```
