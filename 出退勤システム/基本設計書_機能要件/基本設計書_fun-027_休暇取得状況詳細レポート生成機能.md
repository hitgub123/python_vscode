## 基本設計書

| ID      | fun-027                      |
| ------- | ---------------------------- |
| 分類    | 勤怠データの分析・レポート               |
| 機能名  | 休暇取得状況詳細レポート生成機能                   |
| 概要    | 人事部門が、全従業員の休暇取得状況の詳細を月次・四半期・年次で集計し、レポートを生成できる。 |
| 利用者  | 人事部門                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、人事部門が全従業員の休暇取得状況の詳細を月次・四半期・年次で集計し、レポートを生成することを目的とする。

### 2. 適用範囲

本機能は、人事部門の担当者が全従業員の休暇取得状況を把握する必要がある場合に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                  | 型       | 必須   | 備考                                                                                       |
| ---------- | --------------------- | -------- | ------ | ------------------------------------------------------------------------------------------ |
| 期間指定   | レポート対象期間      | 日付型   | 必須   | 月次、四半期、年次を選択可能                                                               |
| 部門指定   | レポート対象部門      | 文字列   | 任意   | 全社または特定の部門を指定可能。未指定の場合は全社。                                                                        |

#### 業務Check

| 項目       | 内容                                                                                   |
| ---------- | ------------------------------------------------------------------------------------ |
| 期間指定   | 有効な日付範囲であること。過去の期間を指定すること。                                                              |
| 部門指定   | 部門指定を行う場合、指定された部門が部門マスタに登録されていること。                                                            |

### 4. 出力

| 項目       | 内容                     | 型       | 備考                               |
| ---------- | ------------------------ | -------- | ---------------------------------- |
| 休暇取得状況詳細レポート |  従業員ごとの休暇取得状況を集計したレポート  | CSV/PDF |  指定された形式で出力                                  |

レポートに含む項目例：

*   従業員ID
*   従業員名
*   所属部門
*   指定期間
*   有給休暇付与日数
*   有給休暇取得日数
*   有給休暇残日数
*   特別休暇取得日数
*   欠勤日数
*   その他休暇日数
*   休暇取得率

### 5. 処理詳細

1.  人事部門担当者が、レポート生成画面で期間（月次、四半期、年次）、部門（任意）を指定する。
2.  システムは、指定された期間と部門に基づいて、従業員テーブル、休暇申請テーブルなどの関連テーブルから必要なデータを抽出する。
3.  抽出されたデータを集計し、休暇取得状況詳細レポートを生成する。
4.  生成されたレポートを指定された形式（CSV/PDFなど）で出力する。

### 6. 例外処理

| 条件                                                                    | 対応                                                                                                                       |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| 入力チェックエラー（期間指定が不正、部門が存在しないなど）           | <span style="color:red;">エラーメッセージを画面に表示し、レポート生成処理を中断する。エラーログを出力する。</span>                                         |
| データ抽出エラー（関連テーブルにデータが存在しないなど）                         | <span style="color:red;">エラーメッセージを画面に表示し、レポート生成処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| レポート生成エラー（ファイル書き込みエラーなど）                                  | <span style="color:red;">エラーメッセージを画面に表示し、レポート生成処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| 指定された期間に該当するデータが存在しない場合 | データが存在しない旨のメッセージを画面に表示する。エラーログは出力しない。 |

### 7. 画面設計

*   レポート生成画面：
    *   期間指定（プルダウンメニュー：月次、四半期、年次）
    *   部門指定（テキストボックスまたはプルダウンメニュー）
    *   レポート出力形式（ラジオボタン：CSV、PDFなど）
    *   レポート生成ボタン
    *   エラーメッセージ表示領域
    *   処理状況表示領域（ローディングアニメーションなど）

### 8. その他

*   セキュリティ：人事情報を取り扱うため、アクセス権限を適切に設定する。
*   パフォーマンス：大規模なデータを取り扱う可能性があるため、処理速度を考慮した設計とする。
*   ログ：レポート生成処理の実行履歴をログに記録する。
