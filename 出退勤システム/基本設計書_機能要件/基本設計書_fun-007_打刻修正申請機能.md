## 基本設計書

| ID      | fun-007                      |
| ------- | ---------------------------- |
| 分類    | 出退勤記録管理               |
| 機能名  | 打刻修正申請機能                   |
| 概要    | 従業員が打刻忘れや誤打刻があった場合に、修正内容（日付、時刻、理由）を記載して申請できる。 |
| 利用者  | 一般従業員                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、従業員が打刻忘れや誤打刻があった場合に、修正内容を申請することを目的とする。

### 2. 適用範囲

本機能は、一般従業員が打刻修正を申請する際に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                                   | 型       | 必須   | 備考                                                                 |
| ---------- | -------------------------------------- | -------- | ------ | -------------------------------------------------------------------- |
| 従業員ID   | 従業員を識別するID                       | 文字列   | 必須   | 社員番号など                                                         |
| 修正対象日 | 修正を希望する日付                       | 日付型   | 必須   |                                                                      |
| 修正時刻   | 修正後の時刻                             | 時刻型   | 必須   |                                                                      |
| 修正理由   | 修正を希望する理由                       | 文字列   | 必須   | 具体的な理由を記述                                                   |

#### 業務Check

| 項目       | 内容                                                                                                                               |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| 従業員ID   | 社員マスタに登録されているIDであること。                                                                                              |
| 修正対象日 | 過去の日付であること。未来の日付は申請不可。                                                                                                |
| 修正時刻   | 妥当な時刻であること。                                                                                                               |
| 修正理由   | 文字数制限などを設けること。                                                                                                         |

### 4. 出力

| 項目             | 内容                                   | 型       | 備考                                                                                               |
| ---------------- | -------------------------------------- | -------- | -------------------------------------------------------------------------------------------------- |
| 打刻修正申請データ | 申請された打刻修正データ                     | データ型 | 従業員ID、修正対象日、修正時刻、修正理由、申請日、申請ステータス（申請中、承認済、却下）などを含む。                                  |
| 管理職への通知     | 打刻修正申請があったことを知らせる通知       |          | メールなどで通知。通知内容：従業員ID、氏名、修正対象日、修正時刻、修正理由。通知先は従業員の所属部署の上長。 |

### 5. 処理詳細

1.  従業員が打刻修正申請画面から、従業員ID、修正対象日、修正時刻、修正理由を入力する。
2.  システムは、入力された情報を基に打刻修正申請データを作成する。
3.  作成された打刻修正申請データをデータベースに登録する。
4.  申請された打刻修正内容を、該当従業員の所属部署の管理職へ通知する。
5.  打刻修正申請が完了した場合、従業員に申請完了メッセージを表示する。

### 6. 例外処理

| 条件                                                                                             | 対応                                                                                                                                                         |
| ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 入力チェックエラー（従業員IDが存在しない、日付の形式が不正など）                                                                  | <span style="color:red;">エラーメッセージを従業員に表示し、申請処理を中断する。エラーログを出力する。</span>                                                                 |
| データベースへの書き込みエラー                                                                                                 | <span style="color:red;">エラーメッセージを従業員に表示し、申請処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                                                                 |
| 管理職への通知エラー                                                                                                     | <span style="color:red;">エラーメッセージを従業員に表示しない。システム管理者に通知する。エラーログを出力する。</span>                                                                          |
| 同一従業員が同じ日に複数回打刻修正申請した場合（未承認の申請が既に存在する場合）                                                            | 未承認の申請が存在する場合は、エラーメッセージを表示し、申請を不可とする。<br><span style="color:red;">エラー発生時はエラーログを出力。</span>                                                                |

### 7. 画面設計

*   打刻修正申請画面：
    *   従業員ID入力フィールド（自動表示または入力）
    *   修正対象日選択カレンダー
    *   修正時刻入力フィールド
    *   修正理由入力テキストエリア
    *   申請ボタン
    *   申請完了メッセージ表示領域
    *   エラーメッセージ表示領域

### 8. その他

*   セキュリティ：従業員IDは暗号化してシステム内で管理する。
*   ログ：全ての打刻修正申請処理（成功/失敗）をログに記録する。
*   承認フロー：管理職による承認・却下機能を追加する（別途詳細設計）。
