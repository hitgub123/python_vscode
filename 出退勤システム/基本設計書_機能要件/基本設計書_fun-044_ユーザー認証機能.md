## 基本設計書

| ID      | fun-044                      |
| ------- | ---------------------------- |
| 分類    | セキュリティ・データ管理               |
| 機能名  | ユーザー認証機能                   |
| 概要    | ユーザーがシステムにアクセスする際に、IDとパスワードまたは多要素認証による本人確認を行う。 |
| 利用者  | 全ての利用者                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、ユーザーがシステムにアクセスする際に、IDとパスワードまたは多要素認証による本人確認を行うことを目的とする。

### 2. 適用範囲

本機能は、全ての利用者がシステムにログインする際に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                  | 型       | 必須   | 備考                                                                                       |
| ---------- | --------------------- | -------- | ------ | ------------------------------------------------------------------------------------------ |
| ユーザーID   | ユーザーを識別するID     | 文字列   | 必須   | ログインID                                                                               |
| パスワード   | ユーザーのパスワード     | 文字列   | 必須   | 暗号化して保存                                                                           |
| 認証情報   | 多要素認証に必要な情報   | 文字列   | 条件付き | 多要素認証が有効な場合のみ必須。認証方式によって内容が異なる（例：ワンタイムパスワード、生体情報） |

#### 業務Check

| 項目       | 内容                                                                                   |
| ---------- | ------------------------------------------------------------------------------------ |
| ユーザーID   | ユーザーマスタに登録されているIDであること。                                                              |
| パスワード   | パスワードポリシー（文字数、複雑さなど）を満たしていること。                                                            |
| 認証情報   | 多要素認証が有効な場合、認証方式に応じた形式であること。                               |

### 4. 出力

| 項目       | 内容                     | 型       | 備考                               |
| ---------- | ------------------------ | -------- | ---------------------------------- |
| 認証結果   | 認証の成否               | 真偽値   | 認証成功：true、認証失敗：false       |
| ユーザーID   | 認証されたユーザーのID    | 文字列   | 認証成功時のみ出力                 |

### 5. 処理詳細

1.  ユーザーがログイン画面でユーザーIDとパスワードを入力する。
2.  システムは、入力されたユーザーIDとパスワードを取得する。
3.  システムは、ユーザーIDを基にユーザーマスタから登録済みのパスワードを取得する。
4.  入力されたパスワードと登録済みのパスワードを比較する。
5.  パスワードが一致した場合、多要素認証が有効かどうかを確認する。
6.  多要素認証が有効な場合、ユーザーに認証情報を要求する。
7.  ユーザーが認証情報を入力する。
8.  システムは、入力された認証情報を検証する。
9.  認証が成功した場合、認証結果としてtrueとユーザーIDを出力する。
10. 認証が失敗した場合、認証結果としてfalseを出力する。

### 6. 例外処理

| 条件                                                                    | 対応                                                                                                                       |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| 入力チェックエラー（ユーザーIDが存在しない、パスワードの形式が不正など）           | <span style="color:red;">エラーメッセージをユーザーに表示し、ログイン処理を中断する。エラーログを出力する。</span>                                         |
| パスワードが一致しない                                                        | <span style="color:red;">エラーメッセージをユーザーに表示し、ログイン処理を中断する。パスワード再設定を促す。エラーログを出力する。</span>                         |
| 多要素認証に失敗した場合                                  | <span style="color:red;">エラーメッセージをユーザーに表示し、ログイン処理を中断する。多要素認証の再試行を促す。エラーログを出力する。</span>                         |
| ユーザーアカウントがロックされている場合                                | <span style="color:red;">エラーメッセージをユーザーに表示し、システム管理者に連絡するように促す。エラーログを出力する。</span> |
| データベースへのアクセスエラー                                                        | <span style="color:red;">エラーメッセージをユーザーに表示し、ログイン処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |

### 7. 画面設計

*   ログイン画面：
    *   ユーザーID入力フィールド
    *   パスワード入力フィールド
    *   ログインボタン
    *   エラーメッセージ表示領域
    *   多要素認証入力フィールド（多要素認証が有効な場合）
*   エラーメッセージ表示：
    *   エラー内容をわかりやすく表示

### 8. その他

*   セキュリティ：パスワードは暗号化してデータベースに保存する。
*   パフォーマンス：認証処理は、2秒以内に完了すること。
*   ログ：全ての認証処理（成功/失敗）をログに記録する。
*   パスワードポリシー：定期的なパスワード変更を推奨する。
*   アカウントロック：一定回数以上ログインに失敗した場合、アカウントをロックする。
