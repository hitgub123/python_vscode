## 基本設計書

| ID      | fun-002                      |
| ------- | ---------------------------- |
| 分類    | 出退勤記録管理               |
| 機能名  | 退勤打刻機能                   |
| 概要    | 従業員が退勤時刻をICカードまたはスマートフォンアプリで打刻できる。 |
| 利用者  | 一般従業員                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、従業員が退勤時刻をICカードまたはスマートフォンアプリを用いてシステムに記録することを目的とする。

### 2. 適用範囲

本機能は、一般従業員の退勤時に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                  | 型       | 必須   | 備考                                                                                       |
| ---------- | --------------------- | -------- | ------ | ------------------------------------------------------------------------------------------ |
| 従業員ID   | 従業員を識別するID     | 文字列   | 必須   | 社員番号など                                                                               |
| 打刻手段   | 打刻に使用する手段     | 列挙型   | 必須   | ICカード or アプリ                                                                        |
| 打刻時刻   | 退勤打刻を行った日時   | 日時型   | 必須   | システムの現在時刻                                                                        |

#### 業務Check

| 項目       | 内容                                                                                   |
| ---------- | ------------------------------------------------------------------------------------ |
| 従業員ID   | 社員マスタに登録されているIDであること。                                                              |
| 打刻時刻   | 未来の日時でないこと。過去の日時であること。                                                            |
| 打刻手段   | システムでサポートされている打刻手段（ICカード、アプリ）のいずれかであること。                               |

### 4. 出力

| 項目       | 内容                     | 型       | 備考                               |
| ---------- | ------------------------ | -------- | ---------------------------------- |
| 退勤時刻   | 打刻された退勤時刻       | 日時型   | システムに記録される時刻           |
| 従業員ID   | 打刻を行った従業員のID    | 文字列   | 記録の紐付けに使用                 |
| 打刻手段   | 打刻に使用された手段       | 列挙型   |                                    |

### 5. 処理詳細

1.  従業員がICカードまたはスマートフォンアプリで打刻を行う。
2.  システムは、入力された従業員ID、打刻手段、打刻時刻を取得する。
3.  取得した情報を基に、退勤情報をシステムに記録する。具体的には、退勤テーブルに以下の情報を登録する。
    *   従業員ID
    *   退勤時刻
    *   打刻手段
4.  打刻処理が成功した場合、従業員に打刻完了メッセージを表示する。

### 6. 例外処理

| 条件                                                                    | 対応                                                                                                                       |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| 入力チェックエラー（従業員IDが存在しない、打刻時刻が未来であるなど）           | <span style="color:red;">エラーメッセージを従業員に表示し、打刻処理を中断する。エラーログを出力する。</span>                                         |
| データベースへの書き込みエラー                                                        | <span style="color:red;">エラーメッセージを従業員に表示し、打刻処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| ICカードリーダーまたはスマートフォンアプリとの通信エラー                                  | <span style="color:red;">エラーメッセージを従業員に表示し、別の手段での打刻を促す。システム管理者に通知する。エラーログを出力する。</span>                         |
| 同一従業員が同じ日に複数回退勤打刻した場合（同一日の退勤データが既に存在する場合） | 同じ日の退勤データが存在する場合は、エラーメッセージを表示するか、もしくは設定により最新の打刻時刻で更新するか選択可能とする。<br><span style="color:red;">エラー発生時はエラーログを出力。</span> |

### 7. 画面設計

*   打刻画面（スマートフォンアプリ）：
    *   打刻ボタン
    *   打刻完了メッセージ表示領域
    *   エラーメッセージ表示領域
*   ICカードリーダー：
    *   打刻状況表示ランプ（成功/失敗）

### 8. その他

*   セキュリティ：従業員IDは暗号化してシステム内で管理する。
*   パフォーマンス：打刻処理は、3秒以内に完了すること。
*   ログ：全ての打刻処理（成功/失敗）をログに記録する。
