## 基本設計書

| ID      | fun-015                      |
| ------- | ---------------------------- |
| 分類    | 残業管理               |
| 機能名  | 残業申請承認機能                   |
| 概要    | 管理職が部下からの残業申請の一覧を確認し、内容を審査した上で承認または却下できる。 |
| 利用者  | 管理職                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、管理職が部下からの残業申請の一覧を確認し、内容を審査した上で承認または却下することを目的とする。

### 2. 適用範囲

本機能は、管理職が部下の残業申請を承認または却下する際に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                  | 型       | 必須   | 備考                                                                                       |
| ---------- | --------------------- | -------- | ------ | ------------------------------------------------------------------------------------------ |
| 管理職ID   | 管理職を識別するID     | 文字列   | 必須   | 社員番号など                                                                               |
| 申請ID     | 残業申請を識別するID   | 文字列   | 必須   | 残業申請ごとに一意に割り振られるID                                                                        |
| 承認/却下選択 | 承認または却下の選択 | 列挙型   | 必須   | 承認、却下のいずれかを選択                                                                        |
| 承認コメント | 承認/却下理由のコメント | 文字列   | 任意   | 承認または却下の理由を記載                                                                        |

#### 業務Check

| 項目       | 内容                                                                                   |
| ---------- | ------------------------------------------------------------------------------------ |
| 管理職ID   | 社員マスタに登録されている管理職のIDであること。                                                              |
| 申請ID     | 残業申請テーブルに存在する申請IDであること。                                                            |
| 承認/却下選択 | 承認、却下のいずれかの値であること。                               |
| 申請ステータス | 申請ステータスが「申請中」であること。                               |

### 4. 出力

| 項目       | 内容                     | 型       | 備考                               |
| ---------- | ------------------------ | -------- | ---------------------------------- |
| 申請ステータス | 更新された申請ステータス       | 文字列   | 承認または却下                     |
| 結果通知     | 従業員への通知メッセージ    | 文字列   | 承認/却下の結果を通知                 |

### 5. 処理詳細

1.  管理職が残業申請一覧画面から、承認または却下する申請を選択する。
2.  管理職が承認または却下を選択し、必要に応じてコメントを入力する。
3.  システムは、入力された管理職ID、申請ID、承認/却下選択、承認コメントを取得する。
4.  取得した情報を基に、残業申請テーブルの申請ステータスを更新する。
    *   承認の場合：申請ステータスを「承認済」に更新する。
    *   却下の場合：申請ステータスを「却下」に更新する。
5.  承認/却下の結果を、申請者に通知する。（メール、システム通知など）
6.  承認/却下処理が成功した場合、管理職に完了メッセージを表示する。

### 6. 例外処理

| 条件                                                                    | 対応                                                                                                                       |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| 入力チェックエラー（管理職IDが存在しない、申請IDが存在しないなど）           | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。エラーログを出力する。</span>                                         |
| データベースへの書き込みエラー                                                        | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| 申請ステータスが「申請中」以外の場合                                  | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。「既に承認/却下されています」などのメッセージを表示する。エラーログを出力する。</span>                         |
| 同一申請IDに対して、複数回承認/却下処理が行われた場合（排他制御） | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。「他のユーザーが処理中です」などのメッセージを表示する。エラーログを出力する。</span> |

### 7. 画面設計

*   残業申請一覧画面：
    *   申請一覧表示
    *   承認/却下ボタン
    *   コメント入力欄
    *   処理完了メッセージ表示領域
    *   エラーメッセージ表示領域

### 8. その他

*   セキュリティ：管理職IDは暗号化してシステム内で管理する。
*   パフォーマンス：承認/却下処理は、3秒以内に完了すること。
*   ログ：全ての承認/却下処理（成功/失敗）をログに記録する。
