## 基本設計書

| ID      | fun-008                      |
| ------- | ---------------------------- |
| 分類    | 出退勤記録管理               |
| 機能名  | 打刻修正申請承認機能                   |
| 概要    | 管理職が部下からの打刻修正申請の一覧を確認し、内容を審査した上で承認または却下できる。 |
| 利用者  | 管理職                   |
| 作成者  |                               |
| 作成日付 |                               |

### 1. 目的

本機能は、管理職が部下からの打刻修正申請を確認し、承認または却下することを目的とする。

### 2. 適用範囲

本機能は、管理職が部下の打刻修正申請を承認または却下する際に適用される。

### 3. 入力

#### 入力項目

| 項目       | 内容                  | 型       | 必須   | 備考                                                                                       |
| ---------- | --------------------- | -------- | ------ | ------------------------------------------------------------------------------------------ |
| 管理職ID   | 管理職を識別するID     | 文字列   | 必須   | 社員番号など                                                                               |
| 申請ID     | 修正申請を識別するID   | 数値     | 必須   | 申請テーブルのID                                                                          |
| 承認/却下選択 | 承認または却下の選択   | 列挙型   | 必須   | 承認、却下のいずれかを選択                                                                 |
| 備考       | 承認/却下理由           | 文字列   | 任意   | 却下時に理由を記載                                                                        |

#### 業務Check

| 項目       | 内容                                                                                   |
| ---------- | ------------------------------------------------------------------------------------ |
| 管理職ID   | 社員マスタに登録されている管理職のIDであること。                                                              |
| 申請ID     | 申請テーブルに存在する申請IDであること。                                                            |
| 承認/却下選択 | 承認または却下のいずれかの値であること。                                                              |
| 申請ステータス | 申請ステータスが「申請中」であること。                                                              |

### 4. 出力

| 項目       | 内容                     | 型       | 備考                               |
| ---------- | ------------------------ | -------- | ---------------------------------- |
| 申請ステータス | 更新後の申請ステータス   | 列挙型   | 承認済、却下済                                    |
| 従業員ID   | 申請者の従業員ID    | 文字列   | 申請テーブルから取得                 |
| 打刻データ   | 承認された打刻データ       | 日時型   | 承認時に打刻テーブルに反映           |
| 結果通知     | 従業員への通知メッセージ | 文字列   | 承認/却下の結果を通知               |

### 5. 処理詳細

1.  管理職がシステムにログインし、打刻修正申請一覧画面を開く。
2.  管理職が申請内容を確認し、承認または却下を選択する。
3.  管理職が承認/却下理由を入力する（却下の場合）。
4.  システムは、入力された管理職ID、申請ID、承認/却下選択、備考を取得する。
5.  取得した情報を基に、以下の処理を行う。
    *   申請テーブルの申請ステータスを更新する（承認済または却下済）。
    *   承認の場合、打刻テーブルの該当する打刻データを更新する。
    *   申請者（従業員）に承認または却下の結果を通知する。
6.  処理が完了した場合、管理職に完了メッセージを表示する。

### 6. 例外処理

| 条件                                                                    | 対応                                                                                                                       |
| ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------- |
| 入力チェックエラー（管理職IDが存在しない、申請IDが存在しないなど）           | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。エラーログを出力する。</span>                                         |
| データベースへの書き込みエラー                                                        | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| 申請ステータスが「申請中」でない場合                                                | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。「既に承認/却下されています」などのメッセージを表示する。エラーログを出力する。</span> |
| 打刻データの更新に失敗した場合（承認時）                                            | <span style="color:red;">エラーメッセージを管理職に表示し、処理を中断する。システム管理者に通知する。エラーログを出力する。</span>                         |
| 従業員への通知送信に失敗した場合                                                    | <span style="color:red;">エラーメッセージを管理職に表示しないが、システム管理者に通知する。エラーログを出力する。</span>                                         |

### 7. 画面設計

*   打刻修正申請一覧画面：
    *   申請一覧（申請ID、従業員ID、申請日時、修正内容、申請理由、ステータス）
    *   承認ボタン
    *   却下ボタン
    *   詳細表示ボタン
*   打刻修正申請詳細画面：
    *   申請内容の詳細情報
    *   承認ボタン
    *   却下ボタン
    *   却下理由入力欄
    *   承認/却下完了メッセージ表示領域
    *   エラーメッセージ表示領域

### 8. その他

*   セキュリティ：管理職IDは暗号化してシステム内で管理する。
*   パフォーマンス：承認/却下処理は、5秒以内に完了すること。
*   ログ：全ての承認/却下処理（成功/失敗）をログに記録する。
*   承認履歴：誰がいつ、どの申請を承認/却下したかの履歴を記録する。
