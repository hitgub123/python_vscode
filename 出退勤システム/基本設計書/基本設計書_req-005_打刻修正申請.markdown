# 基本設計書

## 1. ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、打刻修正申請機能の基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## 2. システム概要
本システムは、従業員が打刻忘れや誤打刻を修正するために、システムを通じて修正申請を行う機能を備えた出退勤システムである。主な機能として、スマートフォンアプリまたはウェブインターフェースを用いた申請機能を提供し、一般従業員が利用することを想定している。

## 3. 要件定義
### 3.1 要件一覧
| ID       | 分類             | 要件名         | 概要                                                                 | 利用者       |
|----------|------------------|----------------|----------------------------------------------------------------------|--------------|
| req-005  | 出退勤記録管理   | 打刻修正申請   | 打刻忘れや誤打刻があった場合、従業員はシステムを通じて打刻修正申請を行える。 | 一般従業員   |

## 4. 機能設計
### 4.1 打刻修正申請機能 (req-005)
#### 4.1.1 機能概要
従業員がスマートフォンアプリまたはウェブインターフェースを通じて、打刻忘れや誤打刻の修正申請を行う機能を提供する。申請は管理職による承認を経て反映される。

#### 4.1.2 入力仕様
- **申請内容**
  - 対象日時：修正対象の打刻日時
  - 修正内容：打刻種別（出社/退社/休憩開始/休憩終了）、修正時刻
  - 理由：修正理由（テキスト入力、必須）
- **認証**
  - ユーザー認証（ログインID、パスワード、または生体認証）が必要。

#### 4.1.3 出力仕様
- **申請結果**
  - 申請受付確認：申請ID、申請日時、申請内容
  - 通知：申請受付時に従業員に通知、管理職に承認依頼通知
- **通知方法**
  - スマートフォンアプリ：プッシュ通知および画面表示
  - ウェブインターフェース：画面表示およびメール通知（設定に応じて）
- **承認結果**
  - 管理職の承認/却下後に従業員に通知（結果、コメント）

#### 4.1.4 処理フロー
1. 利用者がアプリまたはウェブインターフェースで修正申請画面にアクセス。
2. システムが利用者の認証を行う。
3. 利用者が修正内容（対象日時、打刻種別、時刻、理由）を入力。
4. システムが申請データをサーバーに送信し、申請IDを生成。
5. 管理職に承認依頼を通知。
6. 管理職が申請を承認/却下後、結果を従業員に通知。
7. 承認された場合、打刻履歴を更新。

#### 4.1.5 エラー処理
- **認証失敗**：エラーメッセージを表示（例：「ログイン情報が正しくありません」）。
- **無効な申請内容**：エラーメッセージを表示（例：「修正時刻が不正です」）。
- **通信エラー**：エラーメッセージを表示し、再試行を促す。

## 5. データ設計
### 5.1 データベース構造
#### 5.1.1 打刻修正申請テーブル (T_ATTENDANCE_CORRECTION)
| 項目名            | データ型       | 説明                              | 主キー |
|-------------------|----------------|-----------------------------------|--------|
| correction_id     | BIGINT         | 申請ID（自動採番）               | ○      |
| employee_id        | VARCHAR(10)    | 従業員ID                         |        |
| target_timestamp  | DATETIME       | 修正対象日時                    |        |
| attendance_type   | VARCHAR(2)     | 修正打刻種別（出社:01/退社:02/休憩開始:03/休憩終了:04） |        |
| corrected_timestamp | DATETIME     | 修正後時刻                      |        |
| reason            | TEXT           | 修正理由                         |        |
| status            | VARCHAR(2)     | 申請状態（申請中:01/承認:02/却下:03） |        |
| manager_id        | VARCHAR(10)    | 承認者ID                         |        |
| comment           | TEXT           | 承認/却下コメント（任意）         |        |

## 6. インターフェース設計
### 6.1 外部インターフェースÍA
- **スマートフォンアプリ**
  - OS：iOS 15以上、Android 10以上
  - API：RESTful API（JSON形式）
  - 認証：JWTトークンまたは生体認証
- **ウェブインターフェース**
  - 対応ブラウザ：Chrome、Firefox、Safari（最新バージョン）
  - API：RESTful API（JSON形式）
  - 認証：JWTトークン

### 6.2 内部インターフェース
- **サーバー間通信**
  - プロトコル：HTTPS
  - データ形式：JSON
  - エンドポイント例：
    - POST /api/attendance/correction（修正申請登録）
    - GET /api/attendance/correction/status（申請状態取得）

## 7. 非機能要件
### 7.1 性能
- 申請処理：2秒以内に完了
- 同時申請：最大100人/分

### 7.2 可用性
- 稼働率：99.9%
- メンテナンス時間：毎月第2日曜 0:00-3:00

### 7.3 セキュリティ
- データ暗号化：TLS 1.3
- 認証：多要素認証（アプリおよびウェブ）
- アクセス制限：申請は自身のデータのみ、承認は管理職のみ

## 8. テスト計画
### 8.1 単体テスト
- 各コンポーネント（申請入力、申請登録、通知送信、承認処理）の動作確認。
### 8.2 結合テスト
- 申請から承認までのフローが正しく動作することを確認。
### 8.3 負荷テスト
- 100人同時申請時のレスポンスタイムを測定。

## 9. 運用・保守
### 9.1 運用体制
- サポート窓口：平日9:00-17:00
- 障害対応：24時間365日（緊急時）
### 9.2 保守内容
- 月次パッチ適用
- 年次システムアップデート

## 10. 付録
### 10.1 用語集
- 打刻：出社、退社、休憩開始、休憩終了の時刻を記録する行為
- 修正申請：打刻忘れや誤打刻を修正するための申請
- アプリ：出退勤管理用スマートフォンアプリケーション
- ウェブインターフェース：ブラウザ経由でアクセスする申請ページ

### 10.2 参考資料
- 日本IT業界標準設計書テンプレート（JISA）
- 出退勤システム要件定義書（2025年6月版）