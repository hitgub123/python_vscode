# 基本設計書

## 1. ドキュメント概要
本基本設計書は、出退勤システムの要件に基づき、システムの基本設計を定義するものである。日本IT業界の標準的な規範に従い、明確かつ構造化された記述を行う。

## 2. システム概要
本システムは、従業員の出退勤時刻を正確に記録・管理するための出退勤システムである。本設計書では、管理職が部下の残業時間実績を確認できる機能について記述する。

## 3. 要件定義
### 3.1 要件一覧
| ID       | 分類             | 要件名               | 概要                                                                                             | 利用者       |
|----------|------------------|--------------------|--------------------------------------------------------------------------------------------------|--------------|
| req-016  | 残業管理           | 部下残業実績確認     | 管理職は、自身の部下の残業時間実績を月次で確認し、適切な労働時間管理を行える。                                                | 管理職, 人事部門 |

## 4. 機能設計
### 部下残業実績確認機能 (req-016)

#### 機能概要
管理職が、自身の部下の月次残業時間実績を確認できる機能を提供する。人事部門も同様のデータを確認できる。

#### 入力仕様
- **管理職/人事部門による操作**
  - ログインIDとパスワードによる認証。
  - 対象年月を指定。
  - 対象部署（管理職の場合は自身の部署、人事部門の場合は全社または特定部署を選択可能）。

#### 出力仕様
- **画面表示**
  - 部下ごとの残業時間（時間単位）。
  - 残業時間の合計値。
  - 残業時間超過のアラート（設定された閾値を超えた場合）。
- **データ形式**
  - テーブル形式で表示。
  - CSV形式でのダウンロード機能。

#### 処理フロー
1. 管理職または人事部門担当者がシステムにログイン。
2. 対象年月、必要に応じて対象部署を指定。
3. システムが指定された条件で、従業員の残業時間データを集計。
4. 集計結果を画面に表示。
5. 必要に応じてCSV形式でデータをダウンロード。

#### エラー処理
- **認証失敗:** <span style="color:red;">エラーメッセージを表示（例：「IDまたはパスワードが正しくありません。」）</span>
- **データ取得エラー:** <span style="color:red;">「データの取得に失敗しました。システム管理者にお問い合わせください。」というエラーメッセージを表示。</span>
- **権限エラー:** <span style="color:red;">管理職が自身以外の部署の情報を閲覧しようとした場合、「権限がありません。」というエラーメッセージを表示。</span>
- **対象データなし:** <span style="color:red;">指定された年月に対象となる残業データが存在しない場合、「該当データが見つかりませんでした。」というメッセージを表示。</span>

## 5. データ設計
### データベース構造

#### 残業時間テーブル (T_OVERTIME)
| 項目名            | データ型       | 説明                                | 主キー |
|-------------------|----------------|------------------------------------|--------|
| overtime_id       | BIGINT         | 残業時間ID（自動採番）            | ○      |
| employee_id        | VARCHAR(10)    | 従業員ID                          |        |
| year_month        | VARCHAR(6)     | 年月（YYYYMM形式）               |        |
| overtime_hours    | DECIMAL(5,2)   | 残業時間（時間）                   |        |
| created_at        | DATETIME       | データ作成日時                    |        |
| updated_at        | DATETIME       | データ更新日時                    |        |

#### 従業員テーブル (T_EMPLOYEE) ※既存のテーブル
| 項目名            | データ型       | 説明                                | 主キー |
|-------------------|----------------|------------------------------------|--------|
| employee_id       | VARCHAR(10)    | 従業員ID                          | ○      |
| department_id      | VARCHAR(10)    | 部署ID                            |        |
| manager_id       | VARCHAR(10)    | 上長ID（管理職の場合、自身の上長ID） |        |
| ...               | ...            | ...                                |        |

#### 部署テーブル (T_DEPARTMENT) ※既存のテーブル
| 項目名            | データ型       | 説明                                | 主キー |
|-------------------|----------------|------------------------------------|--------|
| department_id     | VARCHAR(10)    | 部署ID                            | ○      |
| department_name   | VARCHAR(50)    | 部署名                            |        |
| ...               | ...            | ...                                |        |

## 6. インターフェース設計
### 画面インターフェース
- **残業実績確認画面**
  - ログイン認証後にアクセス可能。
  - 検索条件入力欄（対象年月、部署）。
  - 残業時間一覧テーブル表示。
  - CSVダウンロードボタン。

### 内部インターフェース
- **API**
  - 残業時間データ取得API
    - エンドポイント：/api/overtime/get_by_month
    - メソッド：GET
    - パラメータ：year_month (必須), department_id (任意)
    - レスポンス：JSON形式で残業時間データを返す。

## 7. 非機能要件
### 性能
- レスポンスタイム：5秒以内
- 同時アクセス数：50人

### セキュリティ
- アクセス制御：ロールベースアクセス制御（RBAC）
- データ暗号化：HTTPS通信

## 8. テスト計画
### 単体テスト
- 残業時間集計ロジックのテスト。
- 画面表示のテスト。
- CSVダウンロード機能のテスト。

### 結合テスト
- ログイン認証との連携テスト。
- 部署情報の連携テスト。

### 負荷テスト
- 同時アクセス数に対するレスポンスタイムの測定。

## 9. 運用・保守
### 運用体制
- サポート窓口：平日9:00-17:00
- 障害対応：24時間365日（緊急時）

### 保守内容
- 月次パッチ適用
- 年次システムアップデート

## 10. 付録
### 用語集
- 残業時間：所定労働時間を超えて労働した時間。
- 管理職：部下を持つ立場の従業員。

### 参考資料
- 出退勤システム要件定義書（2025年6月版）
- 既存システム設計書
